<!DOCTYPE html>
<html lang="hu">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>Slop Library</title>
	<link rel="icon" type="image/svg+xml" href="favicon.svg">
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
	<style>
		:root { 
			--bg-color: #121212; 
			--card-bg: #1e1e1e; 
			--text-color: #e0e0e0; 
			--accent: #ffcc00; 
			--danger: #ff4444; 
			--success: #44ff44;
		}
		body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: var(--text-color); margin: 0; padding-bottom: 50px; }
		
		nav { 
			background: #252525; padding: 10px 30px; display: flex; justify-content: space-between; align-items: center; 
			border-bottom: 2px solid var(--accent); position: sticky; top: 0; z-index: 1000; 
		}

		@font-face {
			font-family: 'gooeyFont';
			src: url('data:font/woff2;charset=utf-8;base64,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') format('woff2'),
				url('data:font/woff;charset=utf-8;base64,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') format('woff');
			font-weight: normal;
			font-style: normal;
			font-display: swap;
		}



		.slime-text {
			font-family: 'gooeyFont' !important;
			font-size: 1.3em; /* A Gooey fontok gyakran vékonyabbak, így nagyobbra vesszük */
			color: var(--accent);
			letter-spacing: 1px;
			vertical-align: middle; /* Hogy szépen illeszkedjen a LIBRARY szóhoz */
			line-height: 1;
		}

		.nav-logo span {
			font-family: 'Segoe UI', sans-serif;
			display: flex;
			align-items: center;
			gap: 5px;
		}

		.nav-logo { 
		    color: var(--accent); 
		    font-size: 1.2em; 
		    font-weight: 900; 
		    letter-spacing: 1px; 
		    text-transform: uppercase;
		    /* Új szabályok a kép és a szöveg egymás mellé rendezéséhez: */
		    display: flex;
		    align-items: center;
		    gap: 12px;
		    cursor: pointer;
		    user-select: none;
		}
		
		.nav-logo img {
		    height: 40px;        /* Ez a magasság illik a szövegedhez */
		    width: auto;         /* EZ A KULCS: ettől nem lesz összenyomva a kazetta! */
		    object-fit: contain; /* Biztosítja, hogy az egész logó látszódjon */
		    display: block;
		}
		.nav-links { display: flex; gap: 15px; }
		nav button { background: none; border: 1px solid var(--accent); color: var(--accent); padding: 8px 18px; cursor: pointer; border-radius: 5px; font-weight: bold; }
		nav button.active { background: var(--accent); color: #000; }

		.container { max-width: 1100px; margin: 20px auto; padding: 0 20px; }
		.page { display: none; }
		.page.active { display: block; }

		.module-box { background: var(--card-bg); padding: 20px; border-radius: 12px; border: 1px solid #444; margin-bottom: 20px; display: none; }
		.form-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
		input, textarea, select { background: #2d2d2d; border: 1px solid #444; color: white; padding: 12px; border-radius: 6px; flex: 1; }
		.ctrl-btn { padding: 12px; font-weight: bold; border-radius: 8px; border: 1px solid #444; background: #252525; color: white; cursor: pointer; flex: 1; transition: 0.2s; }
		.ctrl-btn:disabled { opacity: 0.3; cursor: not-allowed; }
		.ctrl-btn:hover:not(:disabled) { border-color: var(--accent); color: var(--accent); }

		.album-card { display: flex; background: var(--card-bg); border-radius: 10px; overflow: hidden; border: 1px solid #333; margin-bottom: 15px; position: relative; align-items: stretch; }
		.row-number { background: #333; color: #888; display: flex; align-items: center; justify-content: center; min-width: 40px; font-weight: bold; flex-shrink: 0; }
		.album-art-container {
			width: 180px; /* Ugyanaz a szélesség, amit a képnek adtál */
			min-width: 180px; /* Hogy ne nyomja össze a szöveg */
			display: flex;
			align-items: center; /* Függőlegesen középre teszi a képet */
			justify-content: center; /* Vízszintesen középre teszi a képet */
			position: relative;
			overflow: hidden; /* Ez kell majd a homályosított háttérhez */
			background: #151515; /* Egy sötét alap, amíg tölt a kép */
		}
		.album-art-blur {
			position: absolute;
			top: 50%;
			left: 50%;
			width: 120%; /* Kicsit nagyobb, hogy ne látszódjanak a szélei a homályosítás miatt */
			height: 120%;
			object-fit: cover;
			transform: translate(-50%, -50%) scale(1.2); /* Középre teszi és nagyítja */
			filter: blur(12px) brightness(0.5); /* Itt állíthatod a homályosságot és sötétséget */
			z-index: 1; /* Alulra kerül */
			pointer-events: none; /* Ne lehessen rákattintani */
		}
		.album-art {
			width: 160px; /* Kicsit kisebb, mint a konténer, hogy legyen körülötte tér */
			height: 160px;
			object-fit: cover;
			border-radius: 4px;
			cursor: pointer;
			z-index: 2;
			position: relative;
			box-shadow: 0 4px 15px rgba(0,0,0,0.5); /* Egy kis árnyék, hogy elváljon a majdani háttértől */
		}
		.album-info { padding: 15px; flex: 1; display: flex; flex-direction: column; justify-content: center; }
		.artist-name { color: var(--accent); font-size: 1.2em; font-weight: bold; margin: 0; transition: 0.2s; cursor: pointer; display: inline-block; }
		.artist-name:hover { text-decoration: underline; color: #fff; }
		.score-badge { position: absolute; top: 15px; right: 15px; padding: 8px 12px; border-radius: 6px; font-weight: bold; color: white; }
		
		.review-text { font-size: 0.9em; font-style: italic; color: #bbb; margin-top: 10px; border-left: 2px solid var(--accent); padding-left: 10px; }
		.song-container { margin-top: 10px; font-size: 0.8em; }
		.song-label { color: #888; margin-right: 5px; }
		.fav-song-link { color: var(--accent); font-style: italic; text-decoration: underline; display: inline-block; }

		.btn-del { position: absolute; bottom: 10px; right: 10px; background: none; border: none; color: var(--accent); font-size: 1em; cursor: pointer; opacity: 0.6; transition: 0.2s; }
		.btn-del:hover { color: var(--danger); opacity: 1; transform: scale(1.1); }
		.btn-check { background: none; border: 2px solid var(--success); color: var(--success); font-size: 1.5em; border-radius: 50%; width: 45px; height: 45px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; margin-top: 10px; }

		.pagination-container { margin-top: 20px; display: flex; flex-direction: column; align-items: center; gap: 15px; background: #1a1a1a; padding: 20px; border-radius: 10px; border: 1px solid #333; }
		.page-btns { display: flex; gap: 5px; flex-wrap: wrap; justify-content: center; }
		.page-btn { padding: 8px 14px; background: #252525; border: 1px solid #444; color: #fff; border-radius: 5px; cursor: pointer; font-weight: bold; }
		.page-btn.active { background: var(--accent); color: #000; border-color: var(--accent); }
		.page-btn:disabled { opacity: 0.3; cursor: not-allowed; }

		.settings-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #252525; border-radius: 6px; margin-bottom: 5px; }

		.stats-grid {
			display: grid;
			grid-template-columns: 1fr 1fr; /* Két oszlop */
			gap: 20px;
			width: 100%; /* Ez biztosítja, hogy a rács kitöltse a képernyőt */
			box-sizing: border-box;
			padding: 10px;
		}
		.full-width {
			grid-column: span 2; /* Az 1. oszloptól indul és 2 oszlopot fog át */
			width: 100%;
		}
		.stat-card { 
			background: var(--card-bg); 
			padding: 20px; 
			border-radius: 12px; 
			border: 1px solid #444; 
			min-width: 0;
			overflow:hidden;			
		}
		.clickable-list { list-style: none; padding: 0; }
		.clickable-list li { background: #252525; margin-bottom: 6px; padding: 10px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
		.stat-score-pill { padding: 4px 10px; border-radius: 4px; font-weight: bold; font-size: 0.9em; min-width: 35px; text-align: center; }


	@media (max-width: 820px) {
			.stats-grid {
				grid-template-columns: 1fr;
			}
			.full-width, .stat-card {
				grid-column: 1 / span 1;
			}
	}

		#lightbox { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center; }
		#lightbox img { max-width: 90%; max-height: 90%; border: 3px solid var(--accent); }
	#listRecStats li {
		display: flex;
			justify-content: space-between;
		align-items: center;
			padding: 10px 15px;
	}

	/* Ajánló névtábla stílusa */
.recommender-container {
	display: flex;
	flex-direction: column;
	align-items: center;
	margin: 0 15px; /* Távolság a szövegtől és a pontszámtól */
	min-width: fit-content;
}

.rec-label {
	font-size: 0.6rem;
	color: var(--accent);
	text-transform: uppercase;
	font-weight: bold;
	margin-bottom: 2px;
}

.recommender-tag {
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	padding: 4px 10px;
	border-radius: 6px;
	border: 1.5px solid;
	line-height: 1.1;
	text-align: center;
	background: rgba(0,0,0,0.3);
}
.rec-title { font-size: 0.7rem; font-weight: 800; text-transform: uppercase; white-space: nowrap; }
.rec-subtitle { font-size: 0.65rem; font-weight: 400; opacity: 0.9; margin-top: 2px; letter-spacing: -0.3px; display: block; }
.album-card-right { display: flex; align-items: center; justify-content: flex-end; }

/* --- HIÁNYOS KÁRTYÁK STÍLUSAI --- */
.album-card.incomplete-card {
    background: #1e1e1e;
    border-color: #662222;
} 
.row-number.incomplete-row {
    background: #333;
    color: #888;
}
.incomplete-badge {
    color: #aaaaaa;
    font-weight: 900;
    font-size: 0.75em;
    text-transform: uppercase;
    letter-spacing: 1px;
    background: #222;
    padding: 2px 6px;
    border-radius: 4px;
    border: 1px solid #444;
}

.traits-container {
	display: flex;
	flex-wrap: wrap;
	gap: 8px;
	margin: 10px 0;
	padding: 10px;
	background: rgba(0,0,0,0.2);
	border-radius: 8px;
	align-items: center;
}
.traits-title {
	font-size: 12px;
	font-weight: bold;
	color: var(--accent);
	margin-right: 5px;
	text-transform: uppercase;
}
.trait-pill {
	font-size: 12px;
	padding: 4px 6px;
	border-radius: 4px;
	background: #333;
	border: 1px solid #444;
	display: flex;
	flex-direction: column;
	align-items: center;
	min-width: 50px;
	line-weight: 1.2;
}
.trait-name { opacity: 0.7; font-size: 10px; margin-bottom: 1px; }
/* Színkódok a válaszokhoz */
.t-igen { color: #44ff44; text-shadow: 0 0 5px rgba(68,255,68,0.3); }
.t-nem { color: #ff4444; text-shadow: 0 0 5px rgba(255,68,68,0.3); }
.t-meh { color: #888888; }
.t-volt { color: #bb88ff; text-shadow: 0 0 5px rgba(187,136,255,0.3); }
.t-peak { 
    color: #ffcc00; 
    font-weight: 900; 
    border: none !important; /*1px solid #ffcc00 !important; */
    background: none !important; /* rgba(255, 204, 0, 0.1) !important; */
    animation: peak-pulsing 2s infinite ease-in-out;
    transition: all 0.3s;
}
.t-poop { 
    color: #8b4513; /* Barna szín */
    font-weight: 900; 
    text-shadow: 0 0 5px rgba(139,69,19,0.3);
    display: inline-block; /* Fontos, hogy a transform (remegés) működjön rajta */
    animation: poop-shake 0.3s infinite linear;
}
.btn-snap {
	position: absolute;
	top: 75px; /* Az X gomb alatt/felett */
	right: 23px;
	background: rgba(0,0,0,0.6);
	border: 1px solid var(--accent);
	color: var(--accent);
	border-radius: 50%;
	width: 30px;
	height: 30px;
	cursor: pointer;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 16px;
	transition: all 0.2s;
	z-index: 10;
}
.btn-snap:hover {
	background: var(--accent);
	color: #000;
	}
/* --- ÚJ: Info gomb és Info oldal stílusai --- */
.info-btn {
    border-radius: 50% !important; /* Hogy szép kerek legyen */
    width: 25px;
    height: 25px;
    padding: 0 !important;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Georgia', serif; /* Egy klasszikus talpas betűtípus az "i" betűnek */
    font-style: italic;
    font-size: 0.9em;
    margin-left: 10px; /* Egy kis távolság a többi gombtól */
}

.info-content {
    background: var(--card-bg);
    padding: 40px;
    border-radius: 12px;
    border: 1px solid #444;
    line-height: 1.6;
    font-size: 1.1em;
    max-width: 800px;
    margin: 0 auto; /* Középre igazítja a dobozt */
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
}

.info-content p {
    margin-bottom: 15px;
}	

	
/* --- ADMIN LOGIKA FIX --- */
/* 1. Kényszerített rejtés: Elrejtjük a konkrét gombokat a funkciójuk alapján */
#nav-settings, 
button[onclick="toggleMod('add')"], 
button[onclick="toggleMod('addTodo')"],
button[onclick^="editAlbum"], 
button[onclick^="window.editAlbum"], 
button[onclick^="deleteAlbum"], 
button[onclick^="window.deleteAlbum"] {
    display: none !important;
}

/* 2. Felfedés: Ha be vagyunk jelentkezve (is-admin a body-n) */
body.is-admin #nav-settings, 
body.is-admin button[onclick="toggleMod('add')"],
body.is-admin button[onclick="toggleMod('addTodo')"], 
body.is-admin button[onclick^="editAlbum"], 
body.is-admin button[onclick^="window.editAlbum"],
body.is-admin button[onclick^="deleteAlbum"],
body.is-admin button[onclick^="window.deleteAlbum"] {
    display: inline-block !important;
}


@media (max-width: 815px) { /* mobil */
    /* 1. Navigáció: Egymás alá és sortöréssel */
    nav {
        flex-direction: column;
        padding: 15px 10px;
        gap: 15px;
    }
    .nav-links {
        display: flex;
        flex-wrap: wrap;
        justify-content: center; /* Középre igazítja a gombokat */
        gap: 8px; /* Távolság a gombok között */
    }

    .nav-links button {
        /* Megszüntetjük a teljes szélességet */
        flex: 0 1 auto; 
        width: auto; 
        min-width: 60px; /* Hogy ne legyen túl pici sem */
        padding: 8px 12px;
        font-size: 0.85em;
    }

    /* 2. Űrlapok: Oszlopba rendezzük */
    .form-row {
        flex-direction: column;
        align-items: stretch;
    }
    .form-row input, .form-row select, .form-row button {
        width: 100%;
        box-sizing: border-box;
        font-size: 1.1em; /* Kényelmesebb gépelés mobilon */
        padding: 15px;
    }

    /* 3. Teccett-e grid űrlapnál: 2 oszlopos */
    #traitInputs {
        grid-template-columns: 1fr 1fr !important;
    }

    /* ==========================================
       4. ALBUM KÁRTYÁK MOBILON (Banner stílus) 
       ========================================== */
    .album-card {
        flex-direction: column;
        position: relative;
    }
    
    /* Sorszám a banner bal felső sarkában */
    .row-number {
        position: absolute;
        top: 0;
        left: 0;
        height: 35px;
        width: 45px;
        font-size: 1.1em;
        border-bottom-right-radius: 10px;
        z-index: 10;
        background: rgba(0,0,0,0.8);
        color: var(--accent);
    }

    /* Fejléc-szerű borító: teljes szélesség, fix 140px magasság (kb 1/3) */
    .album-art-container {
        width: 100%;
        min-width: 100%;
        height: 350px; 
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
    }
    
    /* Elmosott háttér, ami kitölti a bannert */
    .album-art-blur {
        position: absolute;
        width: 110%;
        height: 110%;
        object-fit: cover;
        filter: blur(10px) brightness(0.4); /* Kicsit sötétebb, hogy a borító jobban kiugorjon */
        z-index: 1;
    }
    
    /* Éles borítókép középen */
    .album-art {
        width: 280px;
        height: 280px;
        object-fit: cover;
        z-index: 2;
        border-radius: 6px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.8); /* Erősebb árnyék */
    }

    /* --- Nagyobb betűk és elrendezés az adatoknál --- */
    .album-info {
		display: flex !important;
		flex-direction: column !important;
		padding: 15px 12px;
		position: relative;
		box-sizing: border-box;
	}
    
    .artist-name {
        font-size: 1.45em; 
        display: block;
        margin-bottom: 4px;
        word-wrap: break-word; 
        max-width: 90%;
    }
    
    .album-info p {
        font-size: 1.15em; 
        margin: 0 0 10px 0;
    }
    
	.album-info small {
        display: block; 
        font-size: 0.95em;
        color: #aaa;
        margin-top: 10px;
        margin-bottom: 15px; 
        padding-bottom: 12px; 
        border-bottom: 1px dashed #444; 
    }

    .score-badge {
        position: absolute;
        top: 20px;
        right: 15px;
        font-size: 1.2em;
        padding: 10px 15px;
    }
    
    .btn-snap {
        position: absolute;
        top: 75px;
        right: 25px;
        width: 38px;
        height: 38px;
        font-size: 20px;
    }

    .review-text {
        font-size: 1.05em;
        margin-top: 0px;
        line-height: 1.5;
    }
    
    /* --- MOBIL 3x2-ES ELRENDEZÉS --- */
	.traits-container {
		display: grid !important;
		/* 3 egyenlő oszlopot hozunk létre */
		grid-template-columns: repeat(3, 1fr) !important;
		gap: 10px !important;
		width: 100% !important;
		padding: 10px 0 !important;
		justify-items: center !important;
	}

	.traits-title {
		/* A cím elfoglalja mind a 3 oszlopot (széltől szélig) */
		grid-column: span 3 !important;
		text-align: center !important;
		font-size: 0.85em !important;
		color: var(--accent);
		width: 100%;
		letter-spacing: 2px;
    	margin-bottom: 5px !important;
	}

	.trait-pill {
		/* Itt már nem kell margin, a grid intézi a távolságot */
		margin: 0 !important;
		width: 100% !important;
		display: flex !important;
		flex-direction: column !important;
		align-items: center !important;
		justify-content: center !important;
		padding: 10px 4px !important;
		background: rgba(255, 255, 255, 0.03); /* Egy leheletnyi háttér a rendezettségért */
		border-radius: 8px;
	}

	.trait-name {
		font-size: 1em !important; /* Kicsit kisebb, hogy elférjenek a hosszú szavak (RIFFEK) */
		margin-bottom: 2px !important;
		opacity: 0.8;
	}

	/* Az értékek (PEAK, MID, stb.) stílusa */
	.trait-pill span:not(.trait-name) {
		font-size: 1.5em !important;
		font-weight: bold;
		letter-spacing: 0.5px;
	}

	.song-container {
		font-size: 1.1em;
		margin-top: 15px;
	}

   .recommender-container {
        position: absolute !important;
        top: 82px !important;
        right: 15px !important;
        width: auto !important;
        background: none !important;
        border: none !important;
        padding: 0 !important;
        margin: 0 !important;
        text-align: right !important;
        display: block !important;
        z-index: 5;
    }

    .rec-label {
        display: block !important;
        font-size: 0.6rem !important;
        text-transform: uppercase;
        color: #888 !important;
        line-height: 1;
        margin-bottom: 2px;
    }

    .rec-title {
        display: block !important;
        font-size: 0.75rem !important;
        font-weight: bold !important;
        color: inherit !important;
        line-height: 1;
    }

    .rec-subtitle {
        display: none !important;
    }

    .btn-snap {
        position: absolute !important;
        top: 105px !important; 
        right: 15px !important;
        width: 30px !important;
        height: 30px !important;
        font-size: 16px !important;
    }

    /* Törlés gomb (kártya alján egy nagy, kényelmes sáv) */
    .btn-del {
        position: relative;
        bottom: 0;
        right: 0;
        display: block;
        width: 100%;
        text-align: center;
        margin-top: 20px;
        background: rgba(255, 68, 68, 0.1);
        padding: 15px;
        font-size: 1.3em;
        border-radius: 6px;
    }
	.info-btn {
			width: 25px !important;
			height: 25px !important;
			min-width: 25px !important; /* Megakadályozza, hogy összenyomják */
			flex: 0 0 25px !important;  /* Tiltja a flexbox-os nyúlást */
			margin: 5px auto !important; /* Középre teszi a sorban, ha szükséges */
			border-radius: 50% !important;
			padding: 0 !important;
			display: flex !important;
			align-items: center;
			justify-content: center;
		}

}

@keyframes peak-pulsing {
  0% { 
    text-shadow: 0 0 8px rgba(255, 204, 0, 0.6);
	transform: scale(1);
  }
  50% { 
    text-shadow: 0 0 12px rgba(255, 204, 0, 1), 0 0 25px rgba(255, 204, 0, 0.4);
    transform: scale(1.02); /* Egy picit meg is nő a lüktetésnél */
  }
  100% { 
    text-shadow: 0 0 8px rgba(255, 204, 0, 0.6);
 	transform: scale(1);
  }
}

@keyframes poop-shake {
  0% { transform: translate(0, 0) rotate(0deg); }
  25% { transform: translate(1px, 1px) rotate(1deg); }
  50% { transform: translate(-1px, -1px) rotate(-1deg); }
  75% { transform: translate(1px, -1px) rotate(1.5deg); }
  100% { transform: translate(0, 0) rotate(0deg); }
}

	</style>
</head>
<body>

<div id="lightbox" onclick="this.style.display='none'"><img id="lb-img" src=""></div>

<nav>
    <div class="nav-logo" onclick="handleTitleClick()" style="cursor:pointer;">
        <img src="favicon.svg" alt="Logo">
        <span>
            <span class="slime-text">Slop</span> Library
        </span>
    </div>
    <div class="nav-links">
	<div class="nav-links">
		<button onclick="showPage('library')" id="nav-library" class="active">KÖNYVTÁR</button>
		<button onclick="showPage('todo')" id="nav-todo">TO-DO</button>
		<button onclick="showPage('stats')" id="nav-stats">STATISZTIKÁK</button>
		<button onclick="showPage('settings')" id="nav-settings" class="admin-only">BEÁLLÍTÁSOK</button>
		<button onclick="showPage('info')" id="nav-info" class="info-btn" title="Infó a Könyvtárról">i</button>
	</div>
</nav>

<div class="container">
	<div id="library" class="page active">
		<div class="form-row">
			<button onclick="toggleMod('add')" class="ctrl-btn admin-only">+ ÚJ BEJEGYZÉS</button>
			<button onclick="toggleMod('search')" class="ctrl-btn">SZŰRÉS</button>
			<button onclick="resetFilters()" class="ctrl-btn" style="border-color: #666; color: #aaa;">ALAPHELYZET</button>
		</div>
		
		<div id="mod-add" class="module-box">
			<div class="form-row">
				<input type="text" id="inArtist" placeholder="Előadó">
				<input type="text" id="inAlbum" placeholder="Album">
				<input type="text" id="inCover" placeholder="Borító URL">
			</div>
			<div id="ratingFields">
				<div class="form-row">
					<input type="number" id="inYear" placeholder="Év">
					<input type="text" id="inGenre" placeholder="Műfajok">
				<label style="display:block; margin-top:10px; font-size:0.8em; color:var(--accent);">AJÁNLOTTA:</label>
				<select id="inRec" style="width:100%; padding:10px; background:#2d2d2d; color:#fff; border:1px solid #444; border-radius:6px;">
					<option value="">-- Saját felfedezés --</option>
					<option value="baal">The Almighty Baal</option>
					<option value="goatlord">Goatlord</option>
					<option value="caller">Caller of Slam Riffs</option>
					<option value="bacchus">Bacchus the Second</option>
					<option value="mammvth">The Mammvth Hvnter</option>
					<option value="gaben">X14Gaben88X</option>
					<option value="christian">Christian Woman</option>
					<option value="max">Max, the Mad</option>
				</select>
					<input type="number" id="inScore" placeholder="Pont" step="0.1">
				</div>
				<div class="form-row">
					<input type="text" id="inFavSong" placeholder="Kiemelt dal címe">
					<input type="text" id="inSongUrl" placeholder="Link a dalhoz">
			<label>Hozzáadás dátuma (vagy Ősidőkben, ha üres):</label>
			<input type="date" id="inDate" style="width:100%; padding:10px; margin-bottom:10px; background:#111; border:1px solid #444; color:white; border-radius:5px;">
				</div>
				<textarea id="inReview" placeholder="Vélemény..."></textarea>
				
				<div style="margin-top:15px; border-top:1px solid #444; padding-top:10px;">
					<h4 style="margin:0 0 10px 0; color:var(--accent); font-size:14px;">Teccet-e? (Traits)</h4>
					<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;" id="traitInputs">
					<div>
						<label style="font-size:11px; display:block;">Riffek</label>
						<select id="t_riff" class="trait-sel">
							<option value="Volt??">Volt??</option>
							<option value="Poop">Poop</option>
							<option value="Nem">Nem</option>
							<option value="Meh" selected>Meh</option>
							<option value="Igen">Igen</option>
							<option value="Peak">Peak</option>
						</select>
					</div>
					<div>
						<label style="font-size:11px; display:block;">Vox</label>
						<select id="t_vox" class="trait-sel">
							<option value="Volt??">Volt??</option>
							<option value="Poop">Poop</option>
							<option value="Nem">Nem</option>
							<option value="Meh" selected>Meh</option>
							<option value="Igen">Igen</option>
							<option value="Peak">Peak</option>
						</select>
					</div>
					<div>
						<label style="font-size:11px; display:block;">Dobok</label>
						<select id="t_dob" class="trait-sel">
							<option value="Volt??">Volt??</option>
							<option value="Poop">Poop</option>
							<option value="Nem">Nem</option>
							<option value="Meh" selected>Meh</option>
							<option value="Igen">Igen</option>
							<option value="Peak">Peak</option>
						</select>
					</div>
					<div>
						<label style="font-size:11px; display:block;">Mix</label>
						<select id="t_mix" class="trait-sel">
							<option value="Volt??">Volt??</option>
							<option value="Poop">Poop</option>
							<option value="Nem">Nem</option>
							<option value="Meh" selected>Meh</option>
							<option value="Igen">Igen</option>
							<option value="Peak">Peak</option>
						</select>
					</div>
					<div>
						<label style="font-size:11px; display:block;">Szöveg</label>
						<select id="t_szoveg" class="trait-sel">
							<option value="Volt??">Volt??</option>
							<option value="Poop">Poop</option>
							<option value="Nem">Nem</option>
							<option value="Meh" selected>Meh</option>
							<option value="Igen">Igen</option>
							<option value="Peak">Peak</option>
						</select>
					</div>
					<div>
						<label style="font-size:11px; display:block;">Vibe</label>
						<select id="t_vibe" class="trait-sel">
							<option value="Volt??">Volt??</option>
							<option value="Poop">Poop</option>
							<option value="Nem">Nem</option>
							<option value="Meh" selected>Meh</option>
							<option value="Igen">Igen</option>
							<option value="Peak">Peak</option>
						</select>
					</div>
				</div>
			</div>
				
			</div>
			<div class="form-row">
				<input type="hidden" id="inTarget" value="library">
				<button onclick="saveAlbum()" class="ctrl-btn" style="background:var(--accent); color:#000; border:none; flex:2;">MENTÉS A KÖNYVTÁRBA</button>
			</div>
		</div>

		<div id="mod-search" class="module-box" style="display:block;">
	<div class="form-row">
		<input type="text" id="gSearch" placeholder="Keresés..." oninput="currentPage=1; runFilter()">
		<select id="fArtist" onchange="currentPage=1; runFilter()"><option value="">Összes előadó</option></select>
		<select id="fYear" onchange="currentPage=1; runFilter()"><option value="">Összes év</option></select>
		<select id="fGenre" onchange="currentPage=1; runFilter()"><option value="">Minden műfaj</option></select>
	</div>
	<div class="form-row" style="margin-top: 10px; border-top: 1px solid #444; padding-top: 10px;">
		<span style="font-size: 0.8em; color: var(--accent); font-weight: bold;">RENDEZÉS:</span>
		<select id="sortField" onchange="currentPage=1; runFilter()" style="flex: 2;">
			<option value="id">Hozzáadás sorrendje (Alapértelmezett)</option>
			<option value="artist">Előadó név</option>
			<option value="album">Album cím</option>
			<option value="year">Évszám</option>
			<option value="genre">Műfaj</option>
			<option value="score">Pontszám</option>
		</select>
		<button onclick="toggleSortOrder()" class="ctrl-btn" style="max-width: 50px;" title="Irány megfordítása">
			<span id="sortDirIcon">▼</span>
		</button>
	</div>
</div>
		<div id="listContainer"></div>
	</div>

<div id="todo" class="page">
		<div class="form-row">
			<button onclick="toggleMod('addTodo')" class="ctrl-btn admin-only" style="margin-bottom: 15px;">+ ÚJ TO-DO</button>
		</div>

		<div id="mod-addTodo" class="module-box" style="display: none;">
			<div class="form-row">
				<input type="text" id="todoArtist" placeholder="Előadó">
				<input type="text" id="todoAlbum" placeholder="Album">
				<input type="text" id="todoCover" placeholder="Borító URL">
			</div>
			<div class="form-row">
				<input type="number" id="todoYear" placeholder="Év">
				<input type="text" id="todoGenre" placeholder="Műfajok">
			</div>
			<div class="form-row" style="align-items: flex-end;">
				<div style="flex: 1;">
					<label style="display:block; margin-top:5px; font-size:0.8em; color:var(--accent);">AJÁNLOTTA:</label>
					<select id="todoRec" style="width:100%; padding:10px; background:#2d2d2d; color:#fff; border:1px solid #444; border-radius:6px;">
						<option value="">-- Saját felfedezés --</option>
						<option value="baal">The Almighty Baal</option>
						<option value="goatlord">Goatlord</option>
						<option value="caller">Caller of Slam Riffs</option>
						<option value="bacchus">Bacchus the Second</option>
						<option value="mammvth">The Mammvth Hvnter</option>
						<option value="gaben">X14Gaben88X</option>
						<option value="christian">Christian Woman</option>
						<option value="max">Max, the Mad</option>
					</select>
				</div>
				<button onclick="saveTodoOnly()" class="ctrl-btn" style="background:var(--accent); color:#000; border:none; flex:1; height: 42px;">TO-DO MENTÉSE</button>
			</div>
		</div>

		<div id="todoContainer"></div>
	</div>

	<div id="stats" class="page">
		<div class="stats-grid">


			<div class="stat-card full-width">
				<h3>Idővonal</h3>
				<div style="height:220px">
					<canvas id="cYear"></canvas>
				</div>
			</div>

		   
			<div class="stat-card full-width" style="display: flex; justify-content: space-around; text-align: center; padding: 20px 0; background: #252525; border: 1px solid #333;">
				<div>
					<small style="color:var(--accent); text-transform: uppercase; letter-spacing: 1px;">Albumok</small>
					<div id="stat-total-albums" style="font-size: 1.6em; font-weight: bold; color: #fff;">0</div>
				</div>
				<div>
					<small style="color:var(--accent); text-transform: uppercase; letter-spacing: 1px;">Előadók</small>
					<div id="stat-total-artists" style="font-size: 1.6em; font-weight: bold; color: #fff;">0</div>
				</div>
				<div>
					<small style="color:var(--accent); text-transform: uppercase; letter-spacing: 1px;">Műfajok</small>
					<div id="stat-total-genres" style="font-size: 1.6em; font-weight: bold; color: #fff;">0</div>
				</div>
				<div>
					<small style="color:var(--accent); text-transform: uppercase; letter-spacing: 1px;">Össz Átl.</small>
					<div id="stat-avg-score" style="font-size: 1.6em; font-weight: bold; color: #fff;">0</div>
				</div>
				<div>
					<small style="color:var(--accent); text-transform: uppercase; letter-spacing: 1px;">Össz yap</small>
					<div id="stat-total-yap" style="font-size: 1.6em; font-weight: bold; color: #fff;">0 szó</div>
				</div>
				<div>
					<small style="color:#ff4444; text-transform: uppercase; letter-spacing: 1px;">Hiányos</small>
					<div id="stat-incomplete" style="font-size: 1.6em; font-weight: bold; color: #ffaaaa;">0</div>
				</div>
			</div>


			<div class="stat-card">
				<h3>Műfajok eloszlása</h3>
				<div style="height:400px">
					<canvas id="cGenre"></canvas>
				</div>
			</div>

			<div class="stat-card">
				<h3>Slop-O-Meter</h3>
				<div style="height:350px; width:120px; margin:auto;">
					<canvas id="cSlop"></canvas>
				</div>
			</div>

			<div class="stat-card full-width">
				<h3>Értékelések eloszlása</h3>
				<div style="height: 220px; width: 97%;">
					<canvas id="cScoreDist"></canvas>
				</div>
			</div>

			<div class="stat-card">
				<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
				<h3 id="topTitle" style="margin: 0;">Top 10</h3>
					<button onclick="toggleTopSort()" class="ctrl-btn" style="max-width: 40px; padding: 5px; margin: 0; display: flex; align-items: center; justify-content: center;" title="Sorrend megfordítása">
					<span id="sortIcon">⇅</span>
					</button>
				</div>
				<div style="display:grid; grid-template-columns: 1fr 1fr; gap:25px;">
					<div>
						<h4 style="color:var(--accent); border-bottom: 1px solid #333; padding-bottom: 5px;">Műfajok</h4>
						<ul id="topG" class="clickable-list"></ul>
					</div>
					<div>
						<h4 style="color:var(--accent); border-bottom: 1px solid #333; padding-bottom: 5px;">Évek</h4>
						<ul id="topY" class="clickable-list"></ul>
					</div>
				</div>
			</div>


		<div class="stat-card">
			   <h3>Ajánlások adatai</h3>
				<ul id="listRecStats" class="clickable-list" style="display: flex; flex-direction: column; gap: 10px;">
					  </ul>
		</div>

		<div class="stat-card full-width">
			<h3>Teccett-e?</h3>
			<div style="height: 300px; position: relative;">
				<canvas id="chartTraits"></canvas>
			</div>
		</div>

		<div class="stat-card full-width">
				<h3>Ritkaságok</h3>
				<ul id="listRare" class="clickable-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px;"></ul>
		</div>
			
	<div style="text-align: center; margin-top: 30px;">
		<button onclick="captureStats()" class="ctrl-btn" style="background: var(--accent); color: #000; max-width: 300px;">
			 STATISZTIKA MÁSOLÁSA VÁGÓLAPRA
		</button>
		<p id="snapshotMsg" style="color: var(--success); display: none; margin-top: 10px;">Kép a vágólapra másolva!</p>
	</div>
</div>
		</div>
	</div>

	<div id="settings" class="page">

		<div class="stat-card" style="margin-bottom:20px;">
			<h3>Ritkasági küszöb</h3>
			<div class="form-row">
				<input type="number" id="setRareLimit" onchange="rareLimit=parseInt(this.value); window.saveToFirebase(); window.renderSettings();">
				<span>(Ennél kevesebb albummal rendelkező műfajok számítanak ritkának)</span>
			</div>
		</div>
		<div class="stat-card" style="margin-bottom:20px;">
			<h3>Slop műfajok beállítása</h3>
			<div id="setG" style="max-height:300px; overflow-y:auto; padding-right:10px;"></div>
		</div>
		<div class="stat-card" style="margin-bottom:20px;">
			<h3>CSV Import</h3>
			<p style="font-size: 0.8em; color: #888; margin-bottom: 10px;">artist;album;year;genre;score;cover;review;favorite;link</p>
			<input type="file" id="csvFileInput" accept=".csv" style="margin-bottom: 10px;">
			<button onclick="handleCSV()" class="ctrl-btn" style="background:var(--accent); color:#000;">IMPORTÁLÁS</button>
		</div>
		<button onclick="if(confirm('Törölsz mindent?')) {localStorage.clear(); location.reload();}" class="ctrl-btn" style="background:var(--danger); margin-top:20px;">ADATOK TÖRLÉSE</button>
	</div>
	<div id="info" class="page">
    <div class="info-content">
        <h2 style="color: var(--accent); margin-top: 0; text-transform: uppercase;">A Moslék Könyvtárról</h2>
        
        <p>Kedves látogató,</p>
        
        <p>Először is, ha nem kerekasztal tag vagy: hogyan a faszba kerültél ide? xddd</p>
        
        <p>Másodszor is: Velkám ürdüngök és ürdünginák! 🤘</p>
        
        <p>Ez a Slop Library, avagy a Moslék Könyvtáram weboldala, webappja (fogalmam sincsen mi a megfelelő megnevezés), ahol a RYM-el párhuzamosan gyűjtöm és naplózom az általam hallgatott muzsikákat.</p>
        
        <p>Minek gyűjtöm? Mert adatok. <strong>ADATOK!!</strong><br>
        MIért nem elég a RYM? Mert alig ad valami statisztikát az általam értékelt zenékről, valamint egy nyilvános komment vagy hozzászólás nélkül nem lehet kifejteni benne a pontosabb véleményem az adott anyagról.</p>
        
        <p>Itt pár szóban - az utókor és önmagam kedvéért - ki tudom fejteni mit gondolok, valamint a hat "Teccett-e" trait-ek osztályozásával gyorsan és érthetően keretbe tudom foglalni az adott zenebona főbb karakterisztikáiról alkotott véleményem. Mindezt egy hosszasan kifejtett kritika írása nélkül, egyszerű vizuális visszajelzésekkel.</p>
        
        <p>Mindemellett drága kis társaságom számára könnyebben és stílusosabban meg tudom osztani a véleményem egy vitatott lemezről, enélkül, hogy a RYM oldalán kellene navigálni.</p>
        
		<p style="color: var(--accent); font-weight: bold; font-size: 1.2em; margin-top: 30px;">Tisztelet és Fém!</p>
		
		<hr style="border: 0; border-top: 1px solid #444; margin: 30px 0;">

		<p style="font-size: 1.2em; color: #888; text-transform: uppercase; letter-spacing: 1px;">
			Ez az oldal részben AI segítségével készült!
		</p>



		<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px;">
			<div style="text-align: center; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; border: 1px solid #333;">
				<span style="display: block; color: var(--accent); font-weight: bold; font-size: 1.2em;">~0.6 kWh</span>
				<span style="font-size: 1.0rem; color: #888; text-transform: uppercase;">Elpazarolt Áram</span>
			</div>
			<div style="text-align: center; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; border: 1px solid #333;">
				<span style="display: block; color: #44aaff; font-weight: bold; font-size: 1.2em;">~1 dl</span>
				<span style="font-size: 1.0rem; color: #888; text-transform: uppercase;">Szerverhűtő Víz</span>
			</div>
			<div style="text-align: center; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; border: 1px solid #333;">
				<span style="display: block; color: var(--success); font-weight: bold; font-size: 1.2em;">~351h</span>
				<span style="font-size: 1.0rem; color: #888; text-transform: uppercase;">Erre pazarolt munkaóra</span>
			</div>
		</div>

		<p style="font-size: 0.8em; font-style: italic; color: #666; margin-top: 15px;">
			*A becslés 200 komplex fejlesztői prompt és a szerverközpontok átlagos fogyasztása alapján készült.
		</p>
		
    </div>
</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
	// https://firebase.google.com/docs/web/setup#available-libraries

	const firebaseConfig = {
	apiKey: "AIzaSyB8vcEb3IvLNqT2R6xS_ax_cm0WFV1fRC8",
	authDomain: "slop-library.firebaseapp.com",
	projectId: "slop-library",
	storageBucket: "slop-library.firebasestorage.app",
	messagingSenderId: "730801831303",
	appId: "1:730801831303:web:be74d9cb6d8b21de7f2722"
	};

	const app = initializeApp(firebaseConfig);
	const db = getFirestore(app);
	const auth = getAuth(app); // Auth inicializálása
	const provider = new GoogleAuthProvider();
	
	let currentUser = null; // Itt tároljuk, be vagyunk-e jelentkezve

	// Kattintás számláló a címre
	let titleClickCount = 0;
	window.handleTitleClick = function() {
		titleClickCount++;
		if (titleClickCount === 3) {
			titleClickCount = 0;
			if (!currentUser) {
				login();
			} else {
				if(confirm("Ki akarsz jelentkezni?")) logout();
			}
		}
		// 2 másodperc után alaphelyzetbe áll a számláló, ha nem jött meg a 3 kattintás
		setTimeout(() => { titleClickCount = 0; }, 2000);
	};

	// Bejelentkezés
	async function login() {
		try {
			await signInWithPopup(auth, provider);
		} catch (error) {
			console.error("Bejelentkezési hiba:", error);
		}
	}

	// Kijelentkezés
	async function logout() {
		await signOut(auth);
		location.reload(); // Tisztasági újratöltés
	}

	// FIGYELŐ: Ez fut le minden változásnál (be/kijelentkezés)
	onAuthStateChanged(auth, (user) => {
		currentUser = user;
		const adminUI = document.querySelectorAll('.admin-only'); // CSS osztály az elemekre
		const settingsMenu = document.querySelector('button[onclick*="settings"]');
		
		if (user) {
			console.log("Bejelentkezve:", user.email);
			// Ha be van jelentkezve: minden látszik
			document.body.classList.add('is-admin');
			if(settingsMenu) settingsMenu.style.display = 'inline-block';
		} else {
			console.log("Vendég mód");
			// Ha nincs bejelentkezve: korlátozások
			document.body.classList.remove('is-admin');
			if(settingsMenu) settingsMenu.style.display = 'none';
			window.showPage('library'); // Ne maradjon a beállításokon, ha kijelentkezik
		}
		runFilter(); // Kártyák újrarajzolása a szerkesztés gomb miatt
	});

window.copyShareLink = function(id) {
    // Kiszámoljuk a share.html elérési útját
    const path = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/'));
    const shareUrl = `${window.location.protocol}//${window.location.host}${path}/share.html?type=album&id=${id}`;

    navigator.clipboard.writeText(shareUrl).then(() => {
        alert("A megosztási link a vágólapra került!");
    });
}

	//aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
	Chart.defaults.devicePixelRatio = 3;
	Chart.register(ChartDataLabels);
	let sortAsc = false;
	let albums = [];
	
	// Kezdeti alapértékek
	let todos = [];
	let slopG = [];
	let rareLimit = 3;
	let charts = {};
	let editIdx = -1;
	let currentPage = 1;
	let itemsPerPage = 25;
	let topSortAsc = false;

	// --- SZŰRŐK ÉS KERESŐ ESEMÉNYKEZELŐJE ---
	setTimeout(() => {
		const filterIds = ['gSearch', 'fArtist', 'fYear', 'fGenre', 'sortField'];
		
		filterIds.forEach(id => {
			const el = document.getElementById(id);
			if (el) {
				// A keresőnél gépeléskor (input), a legördülőknél választáskor (change) szűrünk
				const eventType = id === 'gSearch' ? 'input' : 'change';
				
				el.addEventListener(eventType, () => {
					currentPage = 1; // Visszaugrunk az első oldalra
					
					// Lefuttatjuk a szűrést (megnézi mindkét lehetséges nevét a függvénynek)
					if (typeof window.runFilter === 'function') {
						window.runFilter();
					} else if (typeof runFilter === 'function') {
						runFilter();
					}
				});
			}
		});
	}, 500); // Fél másodperc késleltetés, hogy a HTML biztosan betöltsön

	async function loadFromFirebase() {
		try {
			const docRef = doc(db, "data", "library");
			const docSnap = await getDoc(docRef);

			if (docSnap.exists()) {
				const data = docSnap.data(); // Kimentjük a teljes felhős csomagot
				
				// Betöltjük a felhős adatokat a változókba
				albums = data.albums || [];
				todos = data.todos || [];
				
				if (data.slopG !== undefined) slopG = data.slopG;
				if (data.rareLimit !== undefined) rareLimit = data.rareLimit;

				console.log("🔥 Adatok és beállítások betöltve a Firebase-ből!");
			} else {
				console.log("ℹ️ Nincs adat a Firebase-ben. (Első indítás vagy üres adatbázis)");
				// Vészhelyzeti / Első indítási beolvasás a régi localStorage-ból:
				todos = JSON.parse(localStorage.getItem('slopTodo')) || [];
				slopG = JSON.parse(localStorage.getItem('slopSettings')) || [];
				rareLimit = parseInt(localStorage.getItem('slopRareLimit')) || 8;
			}
			
			// Miután minden adat lejött a felhőből, frissítjük a képernyőt:
			//runFilter(); 
			if (typeof window.showPage === 'function') {
                window.showPage('library');
            } else if (typeof showPage === 'function') {
                showPage('library');
            }
			
			
			// Ha van To-Do rajzoló függvényed, azt is meghívjuk:
			if (typeof updateTodoUI === 'function') updateTodoUI(); 
			
			// És a legfontosabb: frissítjük a Beállítások oldalt is, hogy jó helyen legyenek a pipák!
			if (typeof renderSettings === 'function') renderSettings(); 

		} catch (e) {
			console.error("Hiba a betöltés során: ", e);
		}
	}

	loadFromFirebase();


	const recommenders = {
		"baal": { name1: "The Almighty Baal", name2: "Menace of Bikini Bottom", color: "#FFEB3B" },
		"goatlord": { name1: "Goatlord", name2: "Heir to the Black/Speed Throne", color: "#606060", textColor: "#bbb" },
		"caller": { name1: "Caller of Slam Riffs", name2: "Desecrator of Snare Drums", color: "#1E88E5" },
		"bacchus": { name1: "Bacchus the Second", name2: "the Sodomizer, the Bluntripper", color: "#4CAF50" },
		"mammvth": { name1: "The Mammvth Hvnter", name2: "He Who Preys on Dissodeath", color: "#8D6E63" },
		"gaben": { name1: "X14Gaben88X", name2: "Straightest of all Edges", color: "#AB47BC" },
		"christian": { name1: "Christian Woman", name2: "The wicked wicca", color: "#FF9800" },
		"max": { name1: "Max, the Mad", name2: "Undercover cartel member", color: "#E8E8E8" }
	};

	window.toggleSortOrder = function() {
		sortAsc = !sortAsc;
		document.getElementById('sortDirIcon').innerText = sortAsc ? "▲" : "▼";
		currentPage = 1;
		runFilter();
	}

	window.getRecommenderHTML = function(recKey) {
		if (!recKey || !recommenders[recKey]) return "";
		const data = recommenders[recKey];
		const displayTextColor = data.textColor || data.color;
		return `
			<div class="recommender-container">
				<span class="rec-label">Ajánlotta:</span>
				<div class="recommender-tag" style="border-color: ${data.color}; color: ${displayTextColor};">
					<span class="rec-title">${data.name1}</span>
					<span class="rec-subtitle">${data.name2}</span>
				</div>
			</div>`;
	}

	window.toggleTopSort = function() {
		topSortAsc = !topSortAsc;
		document.getElementById('sortIcon').innerText = topSortAsc ? '⇵' : '⇅';
		renderStats();
	}

	window.showPage = function(id) {
		document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
		document.querySelectorAll('.nav-links button').forEach(b => b.classList.remove('active'));
		const target = document.getElementById(id);
		if(target) target.classList.add('active');
		const btn = document.getElementById('nav-' + id);
		if(btn) btn.classList.add('active');
		
		if(id === 'stats') renderStats();
		if(id === 'library') { initFilters(); runFilter(); }
		if(id === 'settings') renderSettings();
		if(id === 'todo') renderTodo();
	}

	window.toggleMod = function(m) {
		const panels = {
			'add': document.getElementById('mod-add'),
			'search': document.getElementById('mod-search'),
			'addTodo': document.getElementById('mod-addTodo')
		};
		for (const key in panels) {
			if (panels[key]) {
				if (key === m) {
					panels[key].style.display = (panels[key].style.display === 'block' ? 'none' : 'block');
				} else {
					panels[key].style.display = 'none';
				}
			}
		}
	}

	window.saveAlbum = async function() {
		const dateEl = document.getElementById('inDate');
		const dateInput = dateEl ? dateEl.value : '';
		const traits = {
			riff: document.getElementById('t_riff').value,
			vox: document.getElementById('t_vox').value,
			dob: document.getElementById('t_dob').value,
			mix: document.getElementById('t_mix').value,
			szoveg: document.getElementById('t_szoveg').value,
			vibe: document.getElementById('t_vibe').value
		};
		const maxId = albums.length > 0 ? Math.max(...albums.map(a => a.id || 0)) : 0;
		
		const a = {
			id: editIdx > -1 ? albums[editIdx].id : (maxId + 1),
			artist: document.getElementById('inArtist').value.trim(),
			album: document.getElementById('inAlbum').value.trim(),
			coverUrl: document.getElementById('inCover').value.trim(),
			year: document.getElementById('inYear').value,
			genre: document.getElementById('inGenre').value.trim(),
			recommender: document.getElementById('inRec').value,
			myScore: parseFloat(document.getElementById('inScore').value) || 0,
			review: document.getElementById('inReview').value.trim(),
			favSong: document.getElementById('inFavSong').value.trim(),
			songUrl: document.getElementById('inSongUrl').value.trim(),
			traits: traits,
			addedDate: dateInput || 'Ősidőkben'
		};

		if(editIdx > -1) { 
			albums[editIdx] = a; 
			editIdx = -1; 
		} else {
			albums.push(a);
		}
		
		await saveToFirebase(); 
		location.reload();
	}

	// 3. ÚJ FÜGGVÉNY: Kizárólag az új pici To-Do űrlapot menti a Firebase-be
	window.saveTodoOnly = async function() {
		const artist = document.getElementById('todoArtist').value.trim();
		const album = document.getElementById('todoAlbum').value.trim();
		
		if(!artist || !album) {
			alert('Előadó és Album megadása kötelező!');
			return;
		}

		const newTodo = { 
			artist: artist, 
			album: album, 
			coverUrl: document.getElementById('todoCover').value.trim(), 
			year: document.getElementById('todoYear').value,
			genre: document.getElementById('todoGenre').value.trim(),
			recommender: document.getElementById('todoRec').value 
		};

		todos.push(newTodo);
		
		// Mivel az adatbázisod ismeri a "todos" tömböt, csak meg kell hívnunk a mentést
		await saveToFirebase();
		location.reload();
	}
	
	window.renderList = function(data) {
		const container = document.getElementById('listContainer');
		if(!container) return;
		container.innerHTML = '';
		const totalItems = data.length;
		const totalPages = Math.ceil(totalItems / itemsPerPage);
		if (currentPage > totalPages) currentPage = totalPages || 1;
		const start = (currentPage - 1) * itemsPerPage;
		const end = start + itemsPerPage;
		const paginatedData = data.slice(start, end);

		paginatedData.forEach(a => {
			const idx = albums.indexOf(a);

			// --- ÚJ LOGIKA: HIÁNYZÓ ADATOK ELLENŐRZÉSE ---
			const isMissing = (val) => !val || String(val).trim() === '' || String(val).trim() === '0' || String(val).trim() === '?';
			const incomplete = isMissing(a.review) || isMissing(a.favSong) || isMissing(a.coverUrl) || isMissing(a.year) || isMissing(a.album) || isMissing(a.genre);
			// ----------------------------------------------

			const songLabel = a.myScore > 4.5 ? "Kiemelkedő dal:" : "Legkevésbé rossz dal:";
			const getTClass = (val) => {
				if(val === 'Peak') return 't-peak';
				if(val === 'Igen') return 't-igen';
				if(val === 'Nem') return 't-nem';
				if(val === 'Volt??') return 't-volt';
				if(val === 'Poop') return 't-poop';
				return 't-meh';
			};

			const t = a.traits || { riff:'Meh', vox:'Meh', dob:'Meh', mix:'Meh', szoveg:'Meh', vibe:'Meh' };

			const traitsHtml = `
				<div class="traits-container">
					<div class="traits-title">Teccet-e?</div>
					<div class="trait-pill"><span class="trait-name">RIFFEK</span><span class="${getTClass(t.riff)}">${t.riff}</span></div>
					<div class="trait-pill"><span class="trait-name">VOX</span><span class="${getTClass(t.vox)}">${t.vox}</span></div>
					<div class="trait-pill"><span class="trait-name">DOBOK</span><span class="${getTClass(t.dob)}">${t.dob}</span></div>
					<div class="trait-pill"><span class="trait-name">MIX</span><span class="${getTClass(t.mix)}">${t.mix}</span></div>
					<div class="trait-pill"><span class="trait-name">SZÖVEG</span><span class="${getTClass(t.szoveg)}">${t.szoveg}</span></div>
					<div class="trait-pill"><span class="trait-name">VIBE</span><span class="${getTClass(t.vibe)}">${t.vibe}</span></div>
				</div>
			`;
			container.innerHTML += `
				<div class="album-card ${incomplete ? 'incomplete-card' : ''}" id="card-${idx}">
					<div class="row-number ${incomplete ? 'incomplete-row' : ''}">#${a.id || '?'}</div>
					<div class="album-art-container">
						<img src="${a.coverUrl || 'https://via.placeholder.com/120'}" class="album-art-blur">
						<img src="${a.coverUrl || 'https://via.placeholder.com/120'}" class="album-art" onclick="openLB('${a.coverUrl}')">
					</div>
					<div class="album-info">
						<div style="display: flex; justify-content: space-between; align-items: flex-start;">
							<div>
								<div style="display: flex; align-items: center; gap: 10px;">
									<h3 class="artist-name" style="margin: 0; ${incomplete ? 'color: #E86600;' : ''}" onclick="qFilter('a', '${a.artist.replace(/'/g, "\\'")}')">${a.artist}</h3>									
									${incomplete ? '<span class="incomplete-badge">Hiányos!!</span>' : ''}
								</div>
								<p style="margin-top: 5px;"><strong>${a.album}</strong> (${a.year||'?'})</p>
							</div>
							<div style="display: flex; align-items: center; gap: 10px;">
								${getRecommenderHTML(a.recommender)}
								<div class="score-badge" style="background:hsl(${(a.myScore-1)*13},70%,40%); position: static;">${parseFloat(a.myScore).toFixed(1)}</div>
							</div>
						</div>
						<small>${a.genre}</small>
						${a.review ? `<p class="review-text">${a.review}</p>` : ''}
						
						${traitsHtml}
						
						${a.favSong ? `<div class="song-container"><span class="song-label">${songLabel}</span><a href="${a.songUrl}" target="_blank" class="fav-song-link">${a.favSong}</a></div>` : ''}
						
						<div style="margin-top: auto; padding-top: 15px; display: flex; align-items: center; gap: 10px; font-size: 0.8em;">
							<span style="color: #666;">hozzáadva: <strong style="color: #888;">${a.addedDate || 'Ősidőkben'}</strong></span>
							
						<button data-html2canvas-ignore class="edit-btn" onclick="editAlbum(${idx})" style="background:none; border:none; color:var(--accent); cursor:pointer; font-weight:bold; padding:0; text-decoration: underline;">✎ SZERKESZTÉS</button>						</div>
					</div>
					
					<button data-html2canvas-ignore class="btn-snap" onclick="captureCard(this.parentElement, '${a.album.replace(/'/g, "\\'")}')" title="Kép mentése">📷</button>
					<button data-html2canvas-ignore class="btn-del" onclick="deleteAlbum(${idx}, 'lib')">✖</button>
				</div>`;
		});
		if (totalItems > 0) renderPagination(totalPages, totalItems);
	}

	window.captureCard = async function(cardElement, albumName) {
		const img = cardElement.querySelector('.album-art');
		const originalSrc = img.src;

		if (!img.src.includes('data:image')) {
			img.crossOrigin = "anonymous";
			img.src = `https://images.weserv.nl/?url=${encodeURIComponent(originalSrc)}`;
		}
		await new Promise(r => setTimeout(r, 1000));

		html2canvas(cardElement, {
			useCORS: true,
			allowTaint: false,
			backgroundColor: "#1a1a1a", // A kártya háttérszíne a képen
			scale: 2,
			logging: false
		}).then(canvas => {
			const link = document.createElement('a');
			link.download = `${albumName}_review.png`;
			link.href = canvas.toDataURL("image/png");
			link.click();
			
			// Visszaállítjuk az eredeti linket a weboldalon
			img.src = originalSrc;
		}).catch(err => {
			console.error("Hiba:", err);
			img.src = originalSrc;
		});
	}

	window.statsToLibrary = function(recId) {
		// 1. Átváltunk a könyvtár oldalra
		showPage('library');
	
		const searchInput = document.getElementById('gSearch');
		if (searchInput) {
			// Beírjuk az id-t (pl. baal)
			searchInput.value = recId;
		
			if (typeof runFilter === "function") {
				currentPage = 1;
				runFilter();
			}
		}
	};

	window.filterByScore = function(score) {
		// 1. Átváltunk a könyvtárba
		showPage('library');
		
		// 2. Beállítjuk a keresőt
		const searchInput = document.getElementById('gSearch');
		if (searchInput) {
			// Beírjuk a pontszámot (pl. "8.5")
			searchInput.value = score;
			
			// 3. Frissítjük a listát
			if (typeof runFilter === "function") {
				currentPage = 1;
				runFilter();
			}
			
			// Gördülés a tetejére
			window.scrollTo(0, 0);
		}
	};

// 1. Két segédfüggvény a lapozáshoz és a bontás beállításához
window.changePage = function(pageNumber) {
    currentPage = pageNumber;
    window.runFilter(); // Vagy simán runFilter(), ha a modulon belül hívod
    window.scrollTo(0, 0); // Opcionális extra: lapozáskor felugrik az oldal tetejére
};

window.changeItemsPerPage = function(amount) {
    itemsPerPage = parseInt(amount);
    currentPage = 1;
    window.runFilter();
};

// 2. A módosított renderPagination
window.renderPagination = function(totalPages, totalItems) {
	const container = document.getElementById('listContainer');
	let html = `
		<div class="pagination-container">
			<div style="display:flex; align-items:center; gap:10px;">
				<span>Bontás:</span>
				<select onchange="window.changeItemsPerPage(this.value);" style="width:80px; padding:5px;">
					<option value="10" ${itemsPerPage==10?'selected':''}>10</option>
					<option value="25" ${itemsPerPage==25?'selected':''}>25</option>
					<option value="50" ${itemsPerPage==50?'selected':''}>50</option>
					<option value="100" ${itemsPerPage==100?'selected':''}>100</option>
				</select>
				<small style="color:#888;">(Találatok: ${totalItems})</small>
			</div>
			<div class="page-btns">
				<button class="page-btn" onclick="window.changePage(1);" ${currentPage==1?'disabled':''}>«</button>
				${Array.from({length: totalPages}, (_, i) => i + 1).map(p => {
					if (totalPages > 10 && Math.abs(p - currentPage) > 2 && p !== 1 && p !== totalPages) return p === 2 || p === totalPages - 1 ? '...' : '';
					return `<button class="page-btn ${p===currentPage?'active':''}" onclick="window.changePage(${p});">${p}</button>`;
				}).join('').replace(/\.\.\.\.\.\./g, '...')}
				<button class="page-btn" onclick="window.changePage(${totalPages});" ${currentPage==totalPages?'disabled':''}>»</button>
			</div>
		</div>`;
	container.innerHTML += html;
}

	window.renderTodo = function() {
		const container = document.getElementById('todoContainer');
		if(!container) return;
		container.innerHTML = '';
		todos.forEach((t, i) => {
			container.innerHTML += `
				<div class="album-card">
					<div class="row-number">${i+1}</div>
					<img src="${t.coverUrl || 'https://via.placeholder.com/120'}" class="album-art">
					<div class="album-info">
						<div style="display: flex; justify-content: space-between; align-items: flex-start;">
							<div>
								<h3 class="artist-name">${t.artist}</h3>
								<p><strong>${t.album}</strong></p>
							</div>
							${getRecommenderHTML(t.recommender)}
						</div>
						<div style="margin-top: 10px; display: flex; gap: 10px;">
							<button class="btn-check" onclick="moveToRating(${i})">✓</button>
						</div>
						<button class="btn-del" onclick="deleteAlbum(${i}, 'todo')">✖</button>
					</div>
				</div>`;
		});
	}

	window.moveToRating = async function(idx) {
		// EZ A SOR DEFINIÁLJA A "t" VÁLTOZÓT - Ez hiányzott!
		const t = todos[idx]; 
		
		if (!t) return; // Biztonsági ellenőrzés, ha valamiért üres lenne

		// 1. Alapadatok betöltése
		document.getElementById('inArtist').value = t.artist || '';
		document.getElementById('inAlbum').value = t.album || '';
		document.getElementById('inCover').value = t.coverUrl || '';
		document.getElementById('inRec').value = t.recommender || '';

		// 2. Év és Műfaj átemelése
		document.getElementById('inYear').value = t.year || '';
		document.getElementById('inGenre').value = t.genre || '';

		// 3. Biztonsági ürítés: Visszaállítjuk "Meh"-re a legördülőket
		['t_riff', 't_vox', 't_dob', 't_mix', 't_szoveg', 't_vibe'].forEach(id => {
			const el = document.getElementById(id);
			if (el) el.value = 'Meh';
		});
		
		// Egyéb mezők ürítése
		document.getElementById('inScore').value = '';
		document.getElementById('inReview').value = '';
		document.getElementById('inFavSong').value = '';
		document.getElementById('inSongUrl').value = '';
		const dateEl = document.getElementById('inDate');
		if (dateEl) dateEl.value = '';

		// 4. Beállítjuk, hogy új elemet hozunk létre
		editIdx = -1;

		// 5. Eltávolítjuk a To-Do listából az elemet és mentjük a Firebase-be
		todos.splice(idx, 1);
		await saveToFirebase();
		
		// 6. Átlépünk a Könyvtár nézetre és lenyitjuk az űrlapot
		showPage('library');
		const addMod = document.getElementById('mod-add');
		if (addMod && addMod.style.display !== 'block') {
			toggleMod('add');
		}
	}

window.deleteAlbum = async function(i, type) {
    if(!confirm("Kukába a moslékkal?")) return;
    
    // Kezeljük mindkét megnevezést (lib vagy library)
    if(type === 'lib' || type === 'library') {
        albums.splice(i, 1);
    } else {
        todos.splice(i, 1);
    }

    // A localStorage már nem kell, mentsünk a Firebase-be!
    try {
        await saveToFirebase();
        location.reload();
    } catch (err) {
        console.error("Firebase törlési hiba:", err);
        alert("Hiba történt a felhőben való törléskor!");
    }
}

	window.editAlbum = function(i) {
		editIdx = i; 
		const a = albums[i];
		document.getElementById('inArtist').value = a.artist;
		document.getElementById('inAlbum').value = a.album;
		document.getElementById('inCover').value = a.coverUrl;
		document.getElementById('inYear').value = a.year;
		document.getElementById('inGenre').value = a.genre;
		document.getElementById('inScore').value = a.myScore;
		document.getElementById('inReview').value = a.review || "";
		document.getElementById('inFavSong').value = a.favSong || "";
		document.getElementById('inSongUrl').value = a.songUrl || "";
		document.getElementById('inDate').value = '';
		document.getElementById('inRec').value = a.recommender || "";
		const t = a.traits || { riff:'Meh', vox:'Meh', dob:'Meh', mix:'Meh', szoveg:'Meh', vibe:'Meh' };

		document.getElementById('t_riff').value = t.riff;
		document.getElementById('t_vox').value = t.vox;
		document.getElementById('t_dob').value = t.dob;
		document.getElementById('t_mix').value = t.mix;
		document.getElementById('t_szoveg').value = t.szoveg;
		document.getElementById('t_vibe').value = t.vibe;

		toggleMod('add'); window.scrollTo(0,0);
		document.getElementById('inDate').value = (a.addedDate && a.addedDate !== 'Ősidőkben') ? a.addedDate : '';
		showModal('album');
	}

	window.renderSettings = function() {
		document.getElementById('setRareLimit').value = rareLimit;
		const gs = new Set(); albums.forEach(a=>a.genre.split(',').forEach(g=>gs.add(g.trim())));
		const container = document.getElementById('setG');
		if(!container) return;
		container.innerHTML = [...gs].sort().map(g => `
			<div class="settings-row">
				<span>${g}</span>
				<button onclick="tSlop('${g.toLowerCase()}')" style="background:${slopG.includes(g.toLowerCase())?'var(--accent)':'#444'}; border:none; padding:8px 15px; border-radius:4px; cursor:pointer; color:${slopG.includes(g.toLowerCase())?'#000':'#fff'}; font-weight:bold;">
					${slopG.includes(g.toLowerCase())?'SLOP':'RENDES'}
				</button>
			</div>`).join('');
	}

	window.tSlop = function(g) { 
		slopG.includes(g) ? slopG = slopG.filter(x => x !== g) : slopG.push(g); 
		
		// Helyi mentés helyett azonnal küldjük a felhőbe!
		window.saveToFirebase(); 
		window.renderSettings(); 
	}
	window.openLB = function(src) { if(src) { document.getElementById('lb-img').src=src; document.getElementById('lightbox').style.display='flex'; } }
	
	window.resetFilters = function() { 
		document.querySelectorAll('#mod-search select, #mod-search input').forEach(i=>i.value=''); 
		albums.sort((a, b) => {
			let indexA = albums.indexOf(a);
			let indexB = albums.indexOf(b);
			return indexB - indexA; 
		});
		currentPage=1; 
		runFilter(); }

	window.qFilter = function(type, val) { 
		showPage('library'); 
		document.getElementById('mod-search').style.display='block'; 
		resetFilters(); 
		if(type==='g') document.getElementById('fGenre').value=val; 
		if(type==='y') document.getElementById('fYear').value=val; 
		if(type==='a') document.getElementById('fArtist').value=val; 
		currentPage = 1; runFilter(); 
	}

window.handleCSV = function() {
    const file = document.getElementById('csvFileInput').files[0];
    if(!file) return alert("Nincs fájl!");
    
    const r = new FileReader();
    r.onload = async function(e) { // Async-re váltunk a Firebase miatt
        const lines = e.target.result.split('\n');
        const h = lines[0].toLowerCase().trim().split(';');
        const nA = [];
        
        for(let i=1; i<lines.length; i++) {
            if(!lines[i].trim()) continue;
            const c = lines[i].split(';'); 
            const o = {};
            
            h.forEach((name, idx) => {
                let v = c[idx] ? c[idx].trim() : "";
                if(name.includes('artist')||name.includes('előadó')) o.artist = v;
                if(name.includes('album')) o.album = v;
                if(name.includes('year')||name.includes('év')) o.year = v;
                if(name.includes('genre')||name.includes('műfaj')) o.genre = v;
                if(name.includes('score')||name.includes('pont')) o.myScore = parseFloat(v.replace(',','.'))||0;
                if(name.includes('cover')) o.coverUrl = v;
                if(name.includes('review')||name.includes('vélemény')) o.review = v;
                if(name === 'favorite') o.favSong = v;
                if(name === 'link') o.songUrl = v;
				if(name === 'id' || name.includes('sorszám') || name.includes('sorszam')) {
					o.id = parseInt(v);
				}
                // Ha vannak traits (riff, vox stb.) oszlopaidd is a CSV-ben, azokat is itt adhatod hozzá
            });
            if(o.artist && o.album) nA.push(o);
        }

        if(nA.length) { 
            // 1. Frissítjük a helyi listát
            albums = [...albums, ...nA]; 
            
            // 2. Mentés a Firebase-be (és opcionálisan localStorage-ba biztonság kedvéért)
            try {
                await window.saveToFirebase(); 
                localStorage.setItem('slopLibrary', JSON.stringify(albums));
                
                alert(nA.length + " album hozzáadva és felhőbe mentve!");
                location.reload(); 
            } catch (err) {
                console.error("Hiba az importálás közben:", err);
                alert("Hiba történt a felhőbe mentéskor!");
            }
        }
    };
    r.readAsText(file, "UTF-8");
}

	window.initFilters = function() {
		const fill = (id, data, label) => { 
			const el = document.getElementById(id);
			if(el) el.innerHTML = `<option value="">${label}</option>` + [...new Set(data)].sort().map(d=>`<option value="${d}">${d}</option>`).join(''); 
		};
		fill('fArtist', albums.map(a=>a.artist), "Összes előadó");
		fill('fYear', albums.map(a=>a.year).filter(y=>y), "Összes év");
		const gs = new Set(); albums.forEach(a=>a.genre.split(',').forEach(g=>gs.add(g.trim())));
		fill('fGenre', [...gs], "Minden műfaj");
	}

	window.runFilter = function() {
		const q = document.getElementById('gSearch').value.trim();
		const fA = document.getElementById('fArtist').value;
		const fY = document.getElementById('fYear').value;
		const fG = document.getElementById('fGenre').value;
		const sField = document.getElementById('sortField').value;

		// 1. Szűrés
		let res = albums.filter(a => {
			// előadó, albumb vagy ajánló
			const searchTerm = q.toLowerCase();
			
			// Kiszámoljuk, hogy a jelenlegi album hiányos-e
			const isMissing = (val) => !val || String(val).trim() === '' || String(val).trim() === '0' || String(val).trim() === '?';
			const isIncomplete = isMissing(a.review) || isMissing(a.favSong) || isMissing(a.coverUrl) || isMissing(a.year) || isMissing(a.album) || isMissing(a.genre);
			
			// ajánló 
			const recInfo = recommenders[a.recommender] || {};
			const recName = (recInfo.name1 || "").toLowerCase();
			
			//pontszám 
			const searchAsNumber = parseFloat(searchTerm);
			const isNumeric = !isNaN(searchAsNumber);
			
			// Csak akkor egyezzen a pontszám, ha a számérték PONTOSAN ugyanaz
			const scoreMatch = isNumeric && parseFloat(a.myScore) === searchAsNumber;

			let traitMatch = false;
			if (a.traits) {
				traitMatch = Object.values(a.traits).some(val => 
					val && val.toLowerCase().includes(searchTerm)
				);
			}

			let mQ = false;
			if (searchTerm === "hiányos") {
				mQ = isIncomplete; // Csak azokat adja vissza, amik hiányosak
			} else if (searchTerm === "nem hiányos") {
				mQ = !isIncomplete; // Csak azokat, amik teljesek
			} else {
				// A normál kereső működés, ha valami mást írtál be
				mQ = !q || 
				   a.artist.toLowerCase().includes(searchTerm) || 
				   a.album.toLowerCase().includes(searchTerm) ||
				   recName.includes(searchTerm) || 
				   scoreMatch ||
				   traitMatch;
			}
			const mA = !fA || a.artist === fA;
			const mY = !fY || String(a.year) === fY;
			const mG = !fG || a.genre.split(',').map(g=>g.trim().toLowerCase()).includes(fG.toLowerCase());
			
			return mQ && mA && mY && mG;
		});

		// 2. Rendezés
		res.sort((a, b) => {
			let valA, valB;

			if (sField === 'id') {
				// A fix ID alapján (ha még nincs ID-ja, mert régi mentés, akkor marad az index mint "B-terv")
				valA = a.id !== undefined ? parseInt(a.id) : albums.indexOf(a);
				valB = b.id !== undefined ? parseInt(b.id) : albums.indexOf(b);
			} else if (sField === 'score') {
				valA = parseFloat(a.myScore) || 0;
				valB = parseFloat(b.myScore) || 0;
			} else {
				// Szöveges vagy numerikus mezők (artist, album, year, genre)
				valA = (a[sField] || "").toString().toLowerCase();
				valB = (b[sField] || "").toString().toLowerCase();
			}

			if (valA < valB) return sortAsc ? -1 : 1;
			if (valA > valB) return sortAsc ? 1 : -1;
			return 0;
		});

		renderList(res);
	}

	window.renderStats = function() {
		if(!albums.length) return;
		
		const years = {}, genres = {}, gScores = {}, yScores = {};
		let sCount = 0;
		let totalScore = 0;
		let totalWords = 0;
		const uniqueArtists = new Set();
		const uniqueGenres = new Set();

		let validAlbumCount = 0;
		albums.forEach(a => {
			const s = parseFloat(a.myScore) || 0;

			// Csak ha van érvényes pontszám (nagyobb, mint 0)
			if (s > 0) {
				totalScore += s;
				validAlbumCount++;
			}

			uniqueArtists.add(a.artist);
			if(a.review) totalWords += a.review.trim().split(/\s+/).filter(w => w.length > 0).length;

			if(a.year) { 
				years[a.year] = (years[a.year] || 0) + 1; 
				if(!yScores[a.year]) yScores[a.year] = []; 
				// Csak az érvényes pontokat gyűjtjük a statisztikához
				if (s > 0) yScores[a.year].push(s); 
			}

			const tags = String(a.genre).split(',').map(t => t.trim());
			let isS = false;
			tags.forEach(t => { 
				if(t) { 
					uniqueGenres.add(t);
					genres[t] = (genres[t] || 0) + 1; 
					if(!gScores[t]) gScores[t] = []; 
					// Csak az érvényes pontokat gyűjtjük a statisztikához
					if (s > 0) gScores[t].push(s); 
					if(slopG.includes(t.toLowerCase())) isS = true; 
				}
			});
			if(isS) sCount++;
		});

		document.getElementById('stat-total-albums').innerText = albums.length;
		document.getElementById('stat-total-artists').innerText = uniqueArtists.size;
		document.getElementById('stat-total-genres').innerText = uniqueGenres.size;
		document.getElementById('stat-avg-score').innerText = validAlbumCount > 0 ? (totalScore / validAlbumCount).toFixed(2) : "0.00";
		document.getElementById('stat-total-yap').innerText = totalWords + " szó";

		// --- HIÁNYOS BEJEGYZÉSEK SZÁMOLÁSA (Javított verzió) ---
		// Helyben definiáljuk a feltételt, hogy biztosan elérje
		const checkMissing = (val) => {
			if (val === undefined || val === null) return true;
			const s = String(val).trim();
			return s === '' || s === '0' || s === '?' || s === 'https://via.placeholder.com/120';
		};

		let incompleteCount = 0;

		// Fontos: a globális 'albums' tömböt használjuk
		if (window.albums && window.albums.length > 0) {
			window.albums.forEach(a => {
				const isInc = checkMissing(a.review) || 
							  checkMissing(a.favSong) || 
							  checkMissing(a.coverUrl) || 
							  checkMissing(a.year) || 
							  checkMissing(a.album) || 
							  checkMissing(a.genre);
				if (isInc) incompleteCount++;
			});
		} else if (typeof albums !== 'undefined' && albums.length > 0) {
			// Ha modulon belül vagyunk és nincs a window-n
			albums.forEach(a => {
				const isInc = checkMissing(a.review) || 
							  checkMissing(a.favSong) || 
							  checkMissing(a.coverUrl) || 
							  checkMissing(a.year) || 
							  checkMissing(a.album) || 
							  checkMissing(a.genre);
				if (isInc) incompleteCount++;
			});
		}

		const statIncompleteEl = document.getElementById('stat-incomplete');
		if (statIncompleteEl) {
			statIncompleteEl.innerText = incompleteCount;
		}


		const getMedian = (obj) => {
			const vals = Object.values(obj).sort((a, b) => a - b);
			if (vals.length === 0) return 1;
			const mid = Math.floor(vals.length / 2);
			const m = vals.length % 2 !== 0 ? vals[mid] : (vals[mid - 1] + vals[mid]) / 2;
			return Math.max(1, Math.floor(m));
		};

		const gMedian = getMedian(genres);
		const yMedian = getMedian(years);

		document.getElementById('topTitle').innerHTML = `Top 10 <span style="font-size:0.6em; color:#888; font-weight:normal; margin-left:10px;">(min.${gMedian}/műfaj, min.${yMedian}/év)</span>`;

		// --- TOP LISTÁK GENERÁLÁSA ---
		const drawTopList = (scoreObj, countObj, type, threshold) => {
		return Object.entries(scoreObj)
			.filter(([name, scores]) => scores.length >= threshold) // Scores már csak a >0-kat tartalmazza
			.map(([name, scores]) => ({
				name, 
				avg: scores.reduce((p, c) => p + c, 0) / scores.length,
				count: scores.length
			}))
			.sort((a, b) => topSortAsc ? a.avg - b.avg : b.avg - a.avg)
			.slice(0, 10)
			.map(i => `
				<li onclick="qFilter('${type}','${i.name}')">
					<div style="display:flex; flex-direction:column;">
						<span>${i.name}</span>
						<small style="color:#888; font-size:0.7em;">${i.count} db</small>
					</div>
					<span class="stat-score-pill" style="background:hsl(${(i.avg-1)*13},70%,40%)">${i.avg.toFixed(2)}</span>
				</li>`).join('');
		};

	// A cím frissítése is figyeljen az irányra
	const topLabel = topSortAsc ? "Bottom 10" : "Top 10";
	document.getElementById('topTitle').innerHTML = `${topLabel} <span style="font-size:0.6em; color:#888; font-weight:normal; margin-left:10px;">(min.${gMedian}/műfaj, min.${yMedian}/év)</span>`;


		document.getElementById('topG').innerHTML = drawTopList(gScores, genres, 'g', gMedian);
		document.getElementById('topY').innerHTML = drawTopList(yScores, years, 'y', yMedian);

		const genreEntries = Object.entries(genres);
		const mainGenresSorted = genreEntries.filter(e => e[1] >= rareLimit).sort((a, b) => b[1] - a[1]);
		const rareSum = genreEntries.filter(e => e[1] < rareLimit).reduce((acc, curr) => acc + curr[1], 0);

		let chartLabels = mainGenresSorted.map(e => e[0]);
		let chartData = mainGenresSorted.map(e => e[1]);
		if(rareSum > 0) { chartLabels.push("Egyéb (ritka)"); chartData.push(rareSum); }

	if(charts.traits) charts.traits.destroy();
	// --- TECCET-E STATISZTIKA ---
    const traitKeys = ['riff', 'vox', 'dob', 'mix', 'szoveg', 'vibe'];
    const traitLabels = ['RIFFEK', 'VOX', 'DOBOK', 'MIX', 'SZÖVEG', 'VIBE'];
    const ratings = ['Peak', 'Igen', 'Meh', 'Nem', 'Poop', 'Volt??'];
    const rColors = { 
        'Peak': '#ffcc00', 
        'Igen': '#44ff44', 
        'Meh': '#888888', 
        'Nem': '#ff4444', 
        'Poop': '#8b4513', 
        'Volt??': '#bb88ff' 
    };

    // Adatok előkészítése (számlálás)
    let traitCounts = {};
    ratings.forEach(r => { traitCounts[r] = [0,0,0,0,0,0]; });

    albums.forEach(a => {
        const t = a.traits || { riff:'Meh', vox:'Meh', dob:'Meh', mix:'Meh', szoveg:'Meh', vibe:'Meh' };
        traitKeys.forEach((key, i) => {
            const val = t[key] || 'Meh';
            if (traitCounts[val]) traitCounts[val][i]++;
        });
    });

    // Diagram létrehozása
    const totalAlbums = albums.length;
    charts.traits = new Chart(document.getElementById('chartTraits'), {
        type: 'bar',
        data: {
            labels: traitLabels,
            datasets: ratings.map(r => ({
                label: r,
                data: traitCounts[r].map(c => totalAlbums ? Math.round((c / totalAlbums) * 100) : 0),
                backgroundColor: rColors[r]
            }))
        },
        options: {
            indexAxis: 'y', // Ettől lesz vízszintes a sáv
			
            maintainAspectRatio: false,
            scales: {
                x: { stacked: true, max: 100, display: false },
                y: { stacked: true, ticks: { color: '#eee', font: { weight: 'bold' } } }
            },
            plugins: {
                legend: { position: 'bottom', labels: { color: '#ccc', boxWidth: 12 } },
                datalabels: {
                    color: '#000',
                    font: { weight: 'bold', size: 10 },
                    formatter: (v) => v > 5 ? v + '%' : '' // Csak akkor írja ki, ha van hely
                }
            }
        }
    });

	if(charts.g) charts.g.destroy();
		charts.g = new Chart(document.getElementById('cGenre'), { 
			type: 'pie', 
			data: { 
				labels: chartLabels, 
				datasets: [{ 
					data: chartData, 
					backgroundColor: chartLabels.map((l, i) => l === "Egyéb (ritka)" ? "#444" : `hsl(48, 100%, ${Math.max(15, 65 - i * 4)}%)`), 
					borderWidth: 1, 
					borderColor: '#1e1e1e' 
				}] 
			}, 
			options: { 
			devicePixelRatio: 2,
				onClick: (e, el) => { 
					if(el[0]) { 
						const label = chartLabels[el[0].index]; 
						if(label !== "Egyéb (ritka)") {
							qFilter('g', label); 
						} else {
							// Legördít a ritkaságok listájához
							document.getElementById('listRare').scrollIntoView({ behavior: 'smooth' });
						}
					} 
				},
				onHover: (event, chartElement) => {
					// Mutatóujjas kurzor, ha szelet fölé érsz
					event.native.target.style.cursor = chartElement[0] ? 'pointer' : 'default';
				},
				maintainAspectRatio: false, 
				layout: { 
					padding: {
						top: 10,
						bottom: 10,
						left: 60,
						right: 60
					} 
				}, 
				plugins: { 
					title: { display: false }, 
					legend: { display: false }, 
					datalabels: { 
						anchor: 'end', 
						align: 'end', 
						color: '#ccc', 
						offset: 8, 
						formatter: (v, ctx) => ctx.chart.data.labels[ctx.dataIndex] 
					} 
				} 
			}
		});

		if(charts.y) charts.y.destroy();
		const ySorted = Object.keys(years).sort();
		charts.y = new Chart(document.getElementById('cYear'), { 
			type:'bar', data:{labels:ySorted, datasets:[{data:ySorted.map(k=>years[k]), backgroundColor:'#ffcc00'}]}, 
			options:{ 
				devicePixelRatio: 2,
				onClick:(e, el)=>{if(el[0]) qFilter('y', ySorted[el[0].index]);}, 
				maintainAspectRatio:false, layout: { padding: { top: 25 } },
				plugins:{ legend:{display:false}, datalabels:{ display: true, anchor: 'end', align: 'top', color: '#ffcc00', font: { weight: 'bold', size: 11 }, formatter: v => v }},
				scales: { y: { beginAtZero: true, grid: { color: '#333' }, ticks: { display: false } }, x: { grid: { display: false }, ticks: { color: '#ccc', autoSkip: false, maxRotation: 90, minRotation: 90 } } }
			}
		});

		if(charts.s) charts.s.destroy();
		const p = albums.length > 0 ? (sCount/albums.length*100).toFixed(1) : 0;
		charts.s = new Chart(document.getElementById('cSlop'), { 
			type:'bar', data:{labels:[''], datasets:[{data:[p], backgroundColor:'#ffcc00'}, {data:[100-p], backgroundColor:'#333'}]}, 
			options:{
				devicePixelRatio: 2,
				maintainAspectRatio:false, 
				scales:{x:{stacked:true, display:false}, y:{stacked:true, max:100, display:false}}, 
				plugins:{datalabels:{color:'#fff', formatter:v=>v+'%'}, 
				legend:{display:false}}}});

		document.getElementById('listRare').innerHTML = genreEntries.filter(e => e[1] < rareLimit).sort((a,b)=>b[1]-a[1]).map(r=>`<li onclick="qFilter('g','${r[0]}')">${r[0]} <span>${r[1]} db</span></li>`).join('');

		// 1. Adatok kiszámítása
		const recStats = Object.keys(recommenders).map(key => {
			const rData = recommenders[key];
			// Csak azokat az albumokat nézzük, amiknél az ajánló egyezik ÉS a pontszám > 0
			const rAlbums = albums.filter(a => a.recommender === key && (parseFloat(a.myScore) || 0) > 0);
			const count = rAlbums.length;
			const avg = count > 0 ? rAlbums.reduce((sum, a) => sum + (parseFloat(a.myScore) || 0), 0) / count : 0;
			return { key, ...rData, count, avg };
		});

		// 2. A kirajzoló belső függvény
		const drawRecStats = (data) => {
			const container = document.getElementById('listRecStats');
			if(!container) return;

			let html = `
				<li style="background:none; border:none; cursor:default; font-weight:bold; color:var(--accent); font-size:14px; padding:0 10px; min-height:auto; margin-bottom:5px;">
					<div style="flex:1;">NÉV</div>
					<div style="width:100px; text-align:center; cursor:pointer;" onclick="sortRecStats('count')">DARAB ⇅</div>
					<div style="width:100px; text-align:right; cursor:pointer;" onclick="sortRecStats('avg')">ÁTLAG ⇅</div>
				</li>
			`;

			data.forEach(r => {
						html += `
							<li onclick="window.statsToLibrary('${r.name1}')" style="cursor:pointer; padding: 12px 10px; border-bottom: 1px solid #333;" class="rec-stat-row">
								<div style="flex:1; display:flex; align-items:center;">
									<div class="recommender-tag" style="border-color: ${r.color}; color: ${r.textColor || r.color}; margin:0; padding: 6px 12px; min-width: 140px;">
										<span class="rec-title" style="font-size: 14px; display: block; line-height: 1.2;">${r.name1}</span>
										<span class="rec-subtitle" style="font-size: 10px; display: block; opacity: 0.8;">${r.name2}</span>
									</div>
								</div>
								<div style="width:100px; text-align:center; font-weight:bold; font-size:18px;">${r.count}</div>
								<div class="stat-score-pill" style="background:hsl(${(r.avg-1)*13},70%,40%); min-width:65px; font-size:16px; padding: 6px;">${r.avg.toFixed(2)}</div>
							</li>
						`;
			});
			container.innerHTML = html;
		};

		// 3. Kezdeti megjelenítés (alap sorrend szerint)
		drawRecStats(recStats);

		// 4. A globális rendező függvény (hogy a gombok működjenek)
		window.sortRecStats = function(field) {
			if (!window.recSortConfig) window.recSortConfig = { field: null, asc: false };
			
			if (window.recSortConfig.field === field) {
				window.recSortConfig.asc = !window.recSortConfig.asc;
			} else {
				window.recSortConfig.field = field;
				window.recSortConfig.asc = false;
			}

			const sorted = [...recStats].sort((a, b) => {
				return window.recSortConfig.asc ? a[field] - b[field] : b[field] - a[field];
			});
			drawRecStats(sorted);
		};
		const statsToLibrary = (recId) => {
		
		
			// 1. Átváltunk a könyvtár oldalra
			showPage('library');
			
			// 2. Beállítjuk a keresőt
			const searchInput = document.getElementById('gSearch');
			if (searchInput) {
				searchInput.value = recId; // A 'baal', 'goatlord' stb. azonosítót használjuk
				currentPage = 1;
				runFilter();
			}
		};

	const scoreLabels = [];
	for (let s = 1.0; s <= 10.0; s += 0.5) {
		scoreLabels.push(s.toFixed(1)); 
	}

// 2. Adatok összesítése
	const scoreCounts = new Array(scoreLabels.length).fill(0);
	albums.forEach(a => {
		const val = parseFloat(a.myScore);
		if (!isNaN(val) && val >= 1 && val <= 10) {
			// Kerekítés a legközelebbi 0.5-re
			const rounded = Math.round(val * 2) / 2;
			const index = Math.round((rounded - 1) * 2);
			if (index >= 0 && index < scoreCounts.length) {
				scoreCounts[index]++;
			}
		}
	});

// 3. Grafikon létrehozása Pontok eloszlásához
const ctxScore = document.getElementById('cScoreDist').getContext('2d');
new Chart(ctxScore, {
	type: 'bar',
	data: {
		labels: scoreLabels,
		datasets: [{
			label: 'Albumok száma',
			data: scoreCounts,
			backgroundColor: '#ffcc00', // Teljesen sárga, nem átlátszó
			borderColor: '#ffcc00',
			borderWidth: 1,
			borderRadius: 4
		}]
	},
	options: {
			devicePixelRatio: 3,
			responsive: true,
			maintainAspectRatio: false,
			onClick: (event, elements) => {
				if (elements.length > 0) {
					const index = elements[0].index;
					const scoreValue = scoreLabels[index]; // Megkapjuk pl. "8.5"
					
					// Meghívjuk a szűrést (azt a függvényt használjuk, amit korábban írtunk)
					// De mivel ez pontszám, egy kicsit módosítjuk a logikát
					filterByScore(scoreValue);
				}
			},
			// Adjunk egy kis helyet a grafikon tetején, hogy a számok elférjenek
			layout: {
				padding: {
					top: 25 
				}
			},
			plugins: {
				legend: { display: false },
				// EZ AZ ÚJ RÉSZ: A számok megjelenítése az oszlopok felett
				datalabels: {
					anchor: 'end', // Az oszlop végéhez rögzíti
					align: 'top',  // Az oszlop fölé teszi
					color: '#ffcc00', // Sárga szín
					font: {
						weight: 'bold',
						size: 14
					},
					// Csak akkor mutassa a számot, ha nagyobb, mint 0
					formatter: function(value) {
						return value > 0 ? value : '';
					}
				}
			},
			scales: {
				y: {
					beginAtZero: true,
					grid: { display: false }, // A vízszintes rácsvonalakat is kivehetjük a tisztább képért
					ticks: { display: false },
					border: { display: false } // A tengely vonalát is elrejti
				},
				x: {
					grid: { display: false },
					ticks: { 
						color: '#e0e0e0',
						font: { size: 14, weight: 'bold' }
					}
				}
			}
		},
		// Fontos: Engedélyezni kell a bővítményt a grafikonnál
		plugins: [ChartDataLabels]
});

	} 

window.captureStats = async function() {
	const msg = document.getElementById('snapshotMsg');
	const statsPage = document.getElementById('stats');
	const btnContainer = event.target.parentElement; // A gombot tartalmazó div

	// Vizuális visszajelzés a gombon
	const originalBtnText = event.target.innerText;
	event.target.innerText = "⌛ GENERÁLÁS...";
	event.target.disabled = true;

	// 1. ELREJTJÜK a gombot a képről
	btnContainer.style.display = 'none';

	try {
		const canvas = await html2canvas(statsPage, {
			backgroundColor: '#121212',
			scale: 3,
			logging: false,
			useCORS: true,
			scrollX: 0,
			scrollY: -window.scrollY,
			windowWidth: statsPage.scrollWidth,
			windowHeight: statsPage.scrollHeight
		});

		// 2. Visszahozzuk a gombot, amint megvan a "felvétel"
		btnContainer.style.display = 'block';

		canvas.toBlob(async (blob) => {
				try {
				const data = [new ClipboardItem({ [blob.type]: blob })];
				await navigator.clipboard.write(data);
				msg.innerText = "Kép a vágólapra másolva!";
				msg.style.display = 'block';
			} catch (err) {
				const link = document.createElement('a');
				link.download = 'slop_library_statisztika.png';
				link.href = canvas.toDataURL("image/png");
				link.click();
				msg.innerText = "Vágólap hiba - Kép letöltve!";
				msg.style.display = 'block';
			}
		});

	} catch (err) {
		console.error("Hiba:", err);
		btnContainer.style.display = 'block'; // Hiba esetén is hozzuk vissza a gombot
		alert("Hiba történt a generálás közben.");
	} finally {
		event.target.innerText = originalBtnText;
		event.target.disabled = false;
	setTimeout(() => msg.style.display = 'none', 4000);
	}
}

async function saveToFirebase() {
    try {
        // Elmentjük az egészet egy "data" nevű kollekció "current" dokumentumába
        await setDoc(doc(db, "data", "library"), {
            albums: albums,
			todos: todos,
			rareLimit: rareLimit,
			slopG: slopG
        });
        console.log("Sikeres mentés a felhőbe!");
    } catch (e) {
        console.error("Hiba a mentés során: ", e);
    }
}
// Tegyük elérhetővé a localStorage mentés helyett is
window.saveToFirebase = saveToFirebase;

	// Inicializálás
	initFilters();
	runFilter();
</script>
</body>
</html>
